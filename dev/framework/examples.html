<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples · MPIMeasurements</title><meta name="title" content="Examples · MPIMeasurements"/><meta property="og:title" content="Examples · MPIMeasurements"/><meta property="twitter:title" content="Examples · MPIMeasurements"/><meta name="description" content="Documentation for MPIMeasurements."/><meta property="og:description" content="Documentation for MPIMeasurements."/><meta property="twitter:description" content="Documentation for MPIMeasurements."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">MPIMeasurements</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><a class="tocitem" href="../installation.html">Installation</a></li><li><span class="tocitem">Framework</span><ul><li><a class="tocitem" href="scanner.html">Scanner</a></li><li><a class="tocitem" href="devices.html">Devices</a></li><li><a class="tocitem" href="sequences.html">Sequences</a></li><li><a class="tocitem" href="protocols.html">Protocols</a></li><li class="is-active"><a class="tocitem" href="examples.html">Examples</a><ul class="internal"><li><a class="tocitem" href="#Magnetic-Particle-Spectroscopy-(MPS)"><span>Magnetic Particle Spectroscopy (MPS)</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Framework</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../lib/framework/scanner.html">Scanner</a></li><li><a class="tocitem" href="../lib/framework/device.html">Device</a></li><li><a class="tocitem" href="../lib/framework/sequence.html">Sequence</a></li><li><a class="tocitem" href="../lib/framework/protocol.html">Protocol</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Base</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-2-1" type="checkbox"/><label class="tocitem" for="menuitem-4-2-1"><span class="docs-label">Devices</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-2-1-1" type="checkbox"/><label class="tocitem" for="menuitem-4-2-1-1"><span class="docs-label">Robots</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../lib/base/devices/robots/interface.html">Interface</a></li><li><a class="tocitem" href="../lib/base/devices/robots/isel.html">Isel</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2-1-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2-1-2"><span class="docs-label">Virtual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../lib/base/devices/virtual/serialportpool.html">Serial Port Pool</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2-2"><span class="docs-label">Protocols</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../lib/base/protocols/mpimeasurement.html">MPIMeasurement</a></li></ul></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Framework</a></li><li class="is-active"><a href="examples.html">Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="examples.html">Examples</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/MagneticParticleImaging/MPIMeasurements.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/MagneticParticleImaging/MPIMeasurements.jl/blob/master/docs/src/framework/examples.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><h2 id="Magnetic-Particle-Spectroscopy-(MPS)"><a class="docs-heading-anchor" href="#Magnetic-Particle-Spectroscopy-(MPS)">Magnetic Particle Spectroscopy (MPS)</a><a id="Magnetic-Particle-Spectroscopy-(MPS)-1"></a><a class="docs-heading-anchor-permalink" href="#Magnetic-Particle-Spectroscopy-(MPS)" title="Permalink"></a></h2><p>The following is an example setup of an MPS system based on a RedPitaya StemLab 125-14. It has the following configuration directory:</p><pre><code class="nohighlight hljs">MPS/
├── Sequences/
│   └── MPSSequence.toml
├── Protocols/
│   └── MPSProtocol.toml
└── Scanner.toml</code></pre><p>It features two <code>Devices</code>: the <code>RedPitayaDAQ</code> device, which is responsible for signal generation and acquisition, and a virtual <code>Device</code> called <code>TxDAQController</code>. The latter <code>Device</code> is responsible for checking the amplitude and phase of channels that require control and iteratively improving them until the deviation has fallen below a given threshold.</p><p>The <code>RedPitayaDAQ</code> features one transmit channel <code>excitation</code> and two receive channel <code>rx_main</code> and <code>feedback_main</code>. The transmit channel is configured with calibration values, both for itself and for the feedback channel it is associated with. All channel are mapped to the channel of the Red Pitaya hardware.</p><p>To perform an MPS experiement one can use the <code>MPIMeasurementProtocol</code>, which takes a background and a foreground measurement and is capable of storing both in an MDF.</p><h3 id="Scanner.toml"><a class="docs-heading-anchor" href="#Scanner.toml">Scanner.toml</a><a id="Scanner.toml-1"></a><a class="docs-heading-anchor-permalink" href="#Scanner.toml" title="Permalink"></a></h3><pre><code class="language-toml hljs">[General]
boreSize = &quot;6mm&quot;
facility = &quot;Universitätsklinikum Hamburg-Eppendorf&quot;
manufacturer = &quot;IBI&quot;
name = &quot;MPS&quot;
topology = &quot;MPS&quot;
gradient = &quot;0T/m&quot;

[Runtime]
datasetStore = &quot;/opt/data/MPS&quot;
defaultProtocol = &quot;MPSMeasurement&quot;
producerThreadID = 2
consumerThreadID = 3
protocolThreadID = 4

[Devices]
initializationOrder = [
  &quot;txController&quot;,
  &quot;rp_cluster&quot;
]

[Devices.rp_cluster]
deviceType = &quot;RedPitayaDAQ&quot;
dependencies = [&quot;txController&quot;]
ips = [&quot;192.168.1.100&quot;]
rampingMode = &quot;STARTUP&quot;
rampingFraction = 0.2
triggerMode = &quot;INTERNAL&quot;

[Devices.rp_cluster.excitation]
type = &quot;tx&quot;
channel = 1
limitPeak = &quot;1.0V&quot;
sinkImpedance = &quot;HIGH&quot;
calibration = &quot;20.5V/T&quot;
feedback.channelID = &quot;feedback_main&quot;
feedback.calibration = &quot;0.017T/V&quot;

[Devices.rp_cluster.rx_main]
type = &quot;rx&quot;
channel = 1

[Devices.rp_cluster.feedback_main]
type = &quot;rx&quot;
channel = 2

[Devices.txController]
deviceType = &quot;TxDAQController&quot;
dependencies = [&quot;rp_cluster&quot;]
phaseAccuracy = 0.1
amplitudeAccuracy = 0.01
maxControlSteps = 10</code></pre><h3 id="MPSProtocol.toml"><a class="docs-heading-anchor" href="#MPSProtocol.toml">MPSProtocol.toml</a><a id="MPSProtocol.toml-1"></a><a class="docs-heading-anchor-permalink" href="#MPSProtocol.toml" title="Permalink"></a></h3><pre><code class="language-toml hljs">type = &quot;MPIMeasurementProtocol&quot;
description = &quot;Default measurement protocol for the MPS scanner. Acquires a background and forground measurement&quot;
targetScanner = &quot;MPS&quot;

sequence = &quot;MPSSequence&quot;
controlTx = true
fgFrames = 10
bgFrames = 10</code></pre><h3 id="MPSSequence.toml"><a class="docs-heading-anchor" href="#MPSSequence.toml">MPSSequence.toml</a><a id="MPSSequence.toml-1"></a><a class="docs-heading-anchor-permalink" href="#MPSSequence.toml" title="Permalink"></a></h3><pre><code class="language-toml hljs">[General]
name = &quot;MPSSequence&quot;
description = &quot;A sequence with a 26.042 kHz excitation frequency.&quot;
targetScanner = &quot;MPS&quot;
baseFrequency = &quot;125.0MHz&quot;

[Fields]

[Fields.ex]
safeStartInterval = &quot;0.1s&quot;
safeEndInterval = &quot;0.1s&quot;
safeErrorInterval = &quot;0.1s&quot;
control = true
decouple = false

[Fields.ex.excitation]
offset = &quot;0.0mT&quot;

[Fields.ex.excitation.c1]
divider = 4800
amplitude = [&quot;20mT&quot;]
phase = [&quot;0.0rad&quot;]
waveform = &quot;sine&quot;

[Acquisition]
channels = [&quot;rx_main&quot;]
bandwidth = &quot;3.90625MHz&quot;
numPeriodsPerFrame = 1
numFrames = 1
numAverages = 1000
numFrameAverages = 1</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="protocols.html">« Protocols</a><a class="docs-footer-nextpage" href="../lib/framework/scanner.html">Scanner »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 2 April 2024 16:57">Tuesday 2 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
